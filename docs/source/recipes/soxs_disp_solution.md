# soxs_disp_solution

The [`soxs_disp_solution`](#soxspipe.recipes.soxs_disp_solution) recipe generates a first-guess dispersion solution for the instrument (measured along the central trace for each echelle order).

## Input

:::{include} inputs/soxs_disp_solution.md
:::

## Parameters

:::{include} parameters/soxs_disp_solution.md
:::

## Method

After preparing and calibrating the single-pinhole arc-lamp frame, the [`create_dispersion_map`](../utils/create_dispersion_map.md)) util is employed to detect and measure the positions of the arc lines on the frame. Once the line positions have been measured, a dispersion solution is generated by iteratively fitting a global polynomial against the observed line positions (see [`create_dispersion_map`](../utils/create_dispersion_map.md) for details). The algorithm used in the [`soxs_disp_solution`](#soxspipe.recipes.soxs_disp_solution) recipe is shown in {numref}`soxs_disp_solution_diagram`.

:::{figure-md} soxs_disp_solution_diagram
![](soxs_disp_solution.png){width=600px}

The `soxs_disp_solution` recipe algorithm.
:::


## Output

:::{include} output/soxs_disp_solution.md
:::



## QC Metrics

The typical solution for the `soxs_disp_solution` recipe has sub-pixel residuals.


:::{figure-md} soxs_disp_solution_qc
![image-20240924082128619](../_images/image-20240924082128619.png){width=600px}

A QC plot resulting from the `soxs_disp_solution` recipe as run on an Xshooter VIS single pinhole arc lamp frame. A 'good' dispersion solution will have sub-pixel residuals (mean residuals < 0.5 pixels). The top panel shows an Xshooter VIS arc-lamp frame, taken with a single pinhole mask. The green circles represent arc lines detected in the image, and the blue circles and red crosses were detected but dropped due to poor DAOStarFinder fitting or clipped during the polynomial fitting, respectively. The grey circles represent arc lines reported in the static calibration table that failed to be detected on the image.  The second panel shows the same arc-lamp frame with the dispersion solution overlaid at the pixel locations modelled for the original lines in the line list. The third panel shows the residuals of the dispersion solution fit, and the final panel shows the resolution measured for each line (as projected through the pinhole mask) with different colours for each echelle order and the mean order resolution in black.

:::

:::{include} qcs/soxs_disp_solution.md
:::



## Recipe API

:::{autodoc2-object} soxspipe.recipes.soxs_disp_solution.soxs_disp_solution
:::
