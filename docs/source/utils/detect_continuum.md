## Detect Continuum

The purpose of the `detect_continuum` utility is to find and fit the order centres on a single-pinhole flat-lamp frame with low-level polynomials.

The utility takes as input a calibrates single pinhole flat-frame which displays the traces of the order centre locations:

[![](https://live.staticflickr.com/65535/50318769388_03e2329c2f_z.png)](https://live.staticflickr.com/65535/50318769388_03e2329c2f_o.png)

From a spectral format table (specific to the for the arm in question) we know the minimum and maximum wavelength values for each order. Then from the first guess dispersion map generated by `soxs_disp_solution` we can generate an array of approximate pixel locations on each order centre between these wavelength limits.

[![](https://live.staticflickr.com/65535/50341874392_aa0f4f02da_z.png)](https://live.staticflickr.com/65535/50341874392_aa0f4f02da_o.png)

Centred on each of these array pixel positions we take a single-pixel wide image slice in the cross-dispersion direction N-pixels long (N is a recipe parameter). A 1D gaussian is fitted to the flux in the pixel slice and the pixel-position of the peak value is returned.

[![](https://live.staticflickr.com/65535/50320359807_b4ae69c556_z.png)](https://live.staticflickr.com/65535/50320359807_b4ae69c556_o.png)

Finally, for each order, the set of gaussian peak pixel-positions is fitted with a low-order polynomial (X as a function of Y).

$$
X = \sum_{i=0}^n c_{i} \times Y^i 
$$

Where $n$ is the degree of the polynomials. Polynomials are iteratively fitted while sigma-clipping pixel-positions with outlying residuals.

[![](https://live.staticflickr.com/65535/50341080558_27e22d1666_z.png)](https://live.staticflickr.com/65535/50341080558_27e22d1666_o.png)

[![](https://live.staticflickr.com/65535/50341083948_574ff1d452_z.png)](https://live.staticflickr.com/65535/50341083948_574ff1d452_o.png)


![](detect_continuum.png)
